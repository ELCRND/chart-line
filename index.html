<!DOCTYPE html>
<html>

<head>
    <title>line chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            min-height: 90vh;
            background-color: #191A1B;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .chart-container {
            max-width: 800px;
            width: 100%;
            height: 250px;

        }
    </style>
</head>

<body>
    <div class="chart-container">
        <canvas id="chart-line"></canvas>
    </div>

    <script>
        const dates = [
            '2024-05-05', '2024-05-12', '2024-05-19', '2024-05-26',
            '2024-06-02', '2024-06-09', '2024-06-16', '2024-06-26',
            '2024-07-01', '2024-07-08', '2024-07-15', '2024-07-22',
            '2024-08-02'
        ];

        const monthLabels = dates.map(date => {
            const d = new Date(date);
            return d.toLocaleString('ru', { month: 'short' });
        });

        const uniqueMonthLabels = monthLabels.map((month, index, array) => {
            return index === 0 || month !== array[index - 1] ? month : '';
        });

        const chartData = [100000, 103000, 101000, 120000, 125000, 115000, 118000, 116500, 116000, 170000, 160000, 150000, 160000];

        const createGradient = (ctx, chartArea) => {
            const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);

            gradient.addColorStop(0, 'rgba(37, 68, 40, 0.1)');
            gradient.addColorStop(0.5, 'rgba(37, 68, 40, 0.6)');
            gradient.addColorStop(1, 'rgba(37, 68, 40, 1)');

            return gradient;
        };

        const verticalLinePlugin = {
            id: 'verticalLinePlugin',
            beforeDatasetsDraw: function (chart) {
                if (chart.tooltip._active && chart.tooltip._active.length) {
                    const ctx = chart.ctx;
                    const activePoint = chart.tooltip._active[0];
                    const x = activePoint.element.x;
                    const y = activePoint.element.y;
                    const chartArea = chart.chartArea;

                    ctx.save();

                    const gradient = ctx.createLinearGradient(x, chartArea.bottom, x, y);
                    gradient.addColorStop(0, 'rgba(255, 255, 255, 0.1)');
                    gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.4)');
                    gradient.addColorStop(1, 'rgba(255, 255, 255, 1)');

                    ctx.beginPath();
                    ctx.moveTo(x - 1, chartArea.bottom);
                    ctx.lineTo(x - 1, y);
                    ctx.lineTo(x + 1, y);
                    ctx.lineTo(x + 1, chartArea.bottom);
                    ctx.closePath();

                    ctx.fillStyle = gradient;
                    ctx.fill();

                    ctx.restore();
                }
            }
        };


        const gradientTooltipPlugin = {
            id: 'gradientTooltip',
            beforeDraw: function (chart) {
                const tooltip = chart.tooltip;
                if (tooltip._active && tooltip._active.length) {
                    const ctx = chart.ctx;
                    const tooltipModel = tooltip;

                    const gradient = ctx.createLinearGradient(
                        tooltipModel.x,
                        tooltipModel.y - tooltipModel.height,
                        tooltipModel.x,
                        tooltipModel.y
                    );

                    gradient.addColorStop(0, 'rgba(45, 46, 46, 1)');
                    gradient.addColorStop(1, 'rgb(33, 36, 37)');

                    tooltipModel.gradientBackground = gradient;
                }
            }
        };

        const data = {
            labels: uniqueMonthLabels,
            datasets: [{
                label: '',
                data: chartData,
                borderColor: '#4BD158',
                backgroundColor: function (context) {
                    const chart = context.chart;
                    const { ctx, chartArea } = chart;

                    if (!chartArea) {
                        return null;
                    }

                    return createGradient(ctx, chartArea);
                },
                fill: true,
                tension: 0.25,
                pointBackgroundColor: 'transparent',
                pointBorderColor: 'transparent',
                pointHoverBackgroundColor: '#000',
                pointHoverBorderColor: '#FFFFFF',
                pointHoverRadius: 6,
                pointHitRadius: 10
            }]
        };

        const config = {
            type: 'line',
            data: data,
            plugins: [verticalLinePlugin, gradientTooltipPlugin],
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        min: 75000,
                        max: 200000,
                        ticks: {
                            callback: function (value) {
                                const allowedValues = [100000, 125000, 150000, 200000];
                                if (allowedValues.includes(value)) {
                                    return (value / 1000) + 'k';
                                }
                                return null;
                            },
                            stepSize: 25000,
                        },
                        grid: {
                            color: '#363635'
                        }
                    },
                    x: {
                        grid: {
                            color: '#363635'
                        },
                        ticks: {
                            autoSkip: false
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        titleFont: {
                            size: 16,
                        },
                        titleAlign: 'center',
                        bodyFont: {
                            size: 20,
                            weight: 'bold'
                        },
                        bodyAlign: 'center',
                        callbacks: {
                            title: function (context) {
                                const fullDate = new Date(dates[context[0].dataIndex]);
                                return fullDate.toLocaleDateString('ru', {
                                    day: 'numeric',
                                    month: 'long',
                                });
                            },
                            label: function (context) {
                                return `${context.parsed.y / 1000}k`;
                            },
                        },
                        backgroundColor: function (context) {
                            const chart = context.chart;
                            const tooltip = chart.tooltip;
                            return tooltip.gradientBackground || 'rgba(0, 0, 0, 0.8)';
                        },
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        borderColor: 'rgb(65, 66, 67)',
                        borderWidth: 1,
                        displayColors: false,
                        cornerRadius: 30,
                        padding: 20
                    },
                    legend: {
                        display: false,
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        };


        const ctx = document.getElementById('chart-line').getContext('2d');
        const lineChart = new Chart(ctx, config);
    </script>
</body>

</html>